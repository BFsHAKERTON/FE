# yaml
openapi: 3.0.1
info:
  title: "Channel-Talk Notion Integration API"
  description: "채널톡과 노션을 연동하는 서비스 API 명세"
  version: "1.0.0"

# ===============================================
# 1. API Paths (엔드포인트 정의)
# ===============================================
paths:
  # ---------------------------------------------
  # /auth
  # ---------------------------------------------
  /auth/kakao:
    get:
      summary: "카카오 로그인 시작"
      description: "사용자를 카카오 인증 페이지로 리디렉션합니다. redirectUri를 지정하면 로그인 완료 후 해당 URL로 리디렉션됩니다."
      tags: ["Authentication"]
      parameters:
        - in: query
          name: redirectUri
          schema:
            type: string
            format: uri
          required: false
          description: "로그인 완료 후 리디렉션할 URL (없으면 기본값 사용)"
      responses:
        '302':
          description: "카카오 인증 페이지로 리디렉션"
          headers:
            Location:
              description: "카카오 인증 URL"
              schema:
                type: string
                format: uri

  /auth/kakao/callback:
    get:
      summary: "카카오 로그인 콜백"
      description: "카카오 인증 성공 후, HTML 페이지를 반환하여 토큰을 localStorage에 저장하고 지정된 URL로 리디렉션합니다."
      tags: ["Authentication"]
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: false
          description: "카카오에서 발급한 1회용 인증 코드"
        - in: query
          name: error
          schema:
            type: string
          required: false
          description: "인증 실패 시 에러 코드 (예: access_denied)"
        - in: query
          name: state
          schema:
            type: string
          required: false
          description: "로그인 시작 시 전달한 redirectUri (인코딩된 상태)"
      responses:
        '200':
          description: "로그인 성공, HTML 페이지 반환 (토큰 저장 후 리디렉션)"
          content:
            text/html:
              schema:
                type: string
                example: "<html><body><script>localStorage.setItem('accessToken', '...'); window.location.href='...';</script></body></html>"
        '400':
          description: "유효하지 않은 요청 (예: code 누락, 유효하지 않은 code)"
          content:
            text/html:
              schema:
                type: string
                example: "<html><body><script>window.location.href='...?error=INVALID_KAKAO_CODE';</script></body></html>"

  /auth/me:
    get:
      summary: "내 정보 조회"
      description: "현재 로그인된 사용자의 정보를 조회합니다. (AccessToken 필요)"
      tags: ["Authentication"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "사용자 정보 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        '401':
          description: "인증 실패 (토큰 누락, 만료, 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "UNAUTHORIZED"
                  message: "인증이 필요합니다."
        '404':
          description: "사용자 없음 (토큰은 유효하나 DB에 사용자 없음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "USER_NOT_FOUND"
                  message: "사용자를 찾을 수 없습니다."

  # ---------------------------------------------
  # /integrations
  # ---------------------------------------------
  /integrations/channel-talk:
    post:
      summary: "채널톡 API Key 등록"
      description: "사용자의 채널톡 API Key를 등록하고 유효성을 검사합니다."
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      requestBody:
        description: "채널톡 API Key"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChannelTalkRequest"
      responses:
        '200':
          description: "채널톡 연동 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "채널톡 연동에 성공했습니다."
        '400':
          description: "유효하지 않은 API Key"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INVALID_CHANNEL_TALK_KEY"
                  message: "유효하지 않은 채널톡 API Key입니다."
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /integrations/notion/connect:
    get:
      summary: "노션 Oauth 연동 시작"
      description: "노션 Oauth 연동을 시작하기 위해 사용자를 노션 승인 페이지로 리디렉션합니다."
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      responses:
        '302':
          description: "노션 Oauth 승인 페이지로 리디렉션"
          headers:
            Location:
              description: "노션 Oauth URL"
              schema:
                type: string
                format: uri

  /integrations/notion/callback:
    get:
      summary: "노션 Oauth 콜백"
      description: "노션 Oauth 승인 후, 리디렉션되는 콜백 URL입니다. 서버는 토큰을 발급받아 저장합니다."
      tags: ["IntegrATIONS"]
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: true
          description: "노션에서 발급한 1회용 인증 코드"
        - in: query
          name: error
          schema:
            type: string
          required: false
          description: "인증 실패 시 (예: access_denied)"
      responses:
        '200':
          description: "연동 성공. (성공 페이지로 리디렉션 또는 스크립트)"
          content:
            text/html:
              schema:
                type: string
                example: "<html><body>연동에 성공했습니다. 창을 닫아주세요.</body></html>"
        '400':
          description: "유효하지 않은 요청 (code 누락 등)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INVALID_NOTION_CODE"
                  message: "유효하지 않은 노션 인증 코드입니다."

  /integrations/notion/status:
    get:
      summary: "노션 연동 상태 조회"
      description: "현재 노션 연동 상태, 연결된 워크스페이스 이름, 링크 등을 조회합니다."
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "연동 상태 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionStatusResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "노션이 아직 연동되지 않았습니다."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "NOTION_NOT_CONNECTED"
                  message: "노션이 아직 연동되지 않았습니다."

  /integrations/notion:
    delete:
      summary: "노션 연동 해제"
      description: "노션 연동을 해제합니다. (서버에 저장된 토큰 삭제)"
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      responses:
        '204':
          description: "연동 해제 성공. 응답 본문 없음."
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /stats
  # ---------------------------------------------
  /stats/tags/top-weekly:
    get:
      summary: "이번 주 인기 태그 조회"
      description: "최근 7일 동안 생성된 문의를 바탕으로 태그 사용 빈도가 높은 순으로 반환합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            format: int32
            default: 5
            minimum: 1
          required: false
          description: "조회할 태그 개수 (기본 5개)"
      responses:
        '200':
          description: "인기 태그 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagStatListResponse"
              examples:
                weeklySuccess:
                  summary: 최신 인기 태그 예시
                  value:
                    range:
                      start: "2025-11-01T00:00:00Z"
                      end: "2025-11-07T23:59:59Z"
                    items:
                      - tagId: "d1f0f2ab-4b67-4d17-9b38-ef0c1a2f0001"
                        tagName: "배송문의/배송지연"
                        count: 42
                      - tagId: "c2a6e3bc-31d9-4214-a567-ef0c1a2f0002"
                        tagName: "결제문의/환불"
                        count: 35
                      - tagId: "a53ce44e-21d2-4b0a-9bca-ef0c1a2f0003"
                        tagName: "상품문의/교환/사이즈"
                        count: 31
                      - tagId: "b8e8f0a3-89cf-4f56-ae77-ef0c1a2f0004"
                        tagName: "상품문의/재고/입고문의"
                        count: 26
                      - tagId: "ed7c21b4-1325-43a0-8b95-ef0c1a2f0005"
                        tagName: "이벤트/포인트"
                        count: 18
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /stats/tags/monthly:
    get:
      summary: "기간별 태그별 문의 수"
      description: "주어진 기간 동안 문의에 사용된 태그별 카운트를 반환합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 시작 일시 (기본값: 지금으로부터 30일 전)"
        - in: query
          name: end
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 종료 일시 (기본값: 현재 시각)"
      responses:
        '200':
          description: "태그별 문의 수 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagStatListResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /stats/customers/regions:
    get:
      summary: "기간별 고객 지역 분포"
      description: "문의에 저장된 고객 도시 정보를 기반으로 한 달간의 지역 분포 데이터를 제공합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 시작 일시 (기본값: 지금으로부터 30일 전)"
        - in: query
          name: end
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 종료 일시 (기본값: 현재 시각)"
      responses:
        '200':
          description: "고객 지역 분포 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegionDistributionResponse"
              examples:
                regionSuccess:
                  summary: 지역 분포 예시
                  value:
                    range:
                      start: "2025-10-08T00:00:00Z"
                      end: "2025-11-07T23:59:59Z"
                    total: 186
                    items:
                      - city: "서울특별시"
                        count: 68
                        ratio: 0.366
                      - city: "경기도 수원시"
                        count: 32
                        ratio: 0.172
                      - city: "부산광역시"
                        count: 24
                        ratio: 0.129
                      - city: "인천광역시"
                        count: 18
                        ratio: 0.097
                      - city: "대구광역시"
                        count: 16
                        ratio: 0.086
                      - city: "광주광역시"
                        count: 12
                        ratio: 0.064
                      - city: "기타"
                        count: 16
                        ratio: 0.086
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /stats/inquiries/raw:
    get:
      summary: "다차원 분석용 원자료"
      description: "태그, 상담 시각, 요일, 고객 정보를 포함한 원자료를 반환합니다. 프런트에서 자유롭게 가공할 수 있습니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 시작 일시 (기본값: 지금으로부터 30일 전)"
        - in: query
          name: end
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 종료 일시 (기본값: 현재 시각)"
        - in: query
          name: limit
          schema:
            type: integer
            format: int32
            minimum: 1
          required: false
          description: "최대 반환 행 수 (미지정 시 전체 반환, 필요시 페이지네이션 적용)"
      responses:
        '200':
          description: "원자료 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InquiryRawResponse"
              example:
                range:
                  start: "2025-10-09T00:00:00Z"
                  end: "2025-11-07T23:59:59Z"
                items:
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174001"
                    createdAt: "2025-11-06T02:12:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174000"
                    tagName: "배송문의/배송지연"
                    customerCity: "서울특별시"
                    customerGrade: "VIP"
                    channelTalkUserId: "ch_001"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174010"
                    createdAt: "2025-11-06T09:05:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174008"
                    tagName: "상품문의/교환/불량"
                    customerCity: "서울특별시"
                    customerGrade: "일반"
                    channelTalkUserId: "ch_008"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174002"
                    createdAt: "2025-11-06T10:45:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174001"
                    tagName: "결제문의/환불"
                    customerCity: "부산광역시"
                    customerGrade: "일반"
                    channelTalkUserId: "ch_002"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174011"
                    createdAt: "2025-11-06T15:20:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174009"
                    tagName: "상품문의/재고/입고문의"
                    customerCity: "인천광역시"
                    customerGrade: null
                    channelTalkUserId: "ch_009"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174003"
                    createdAt: "2025-11-05T14:31:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174002"
                    tagName: "상품문의/교환/사이즈"
                    customerCity: "대구광역시"
                    customerGrade: null
                    channelTalkUserId: "ch_003"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174012"
                    createdAt: "2025-11-05T09:12:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-42661417400a"
                    tagName: "배송문의/배송조회"
                    customerCity: "경기도 성남시"
                    customerGrade: "일반"
                    channelTalkUserId: null
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174004"
                    createdAt: "2025-11-05T22:05:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174003"
                    tagName: "이벤트/포인트"
                    customerCity: "인천광역시"
                    customerGrade: "일반"
                    channelTalkUserId: "ch_004"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174005"
                    createdAt: "2025-11-04T08:10:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174004"
                    tagName: "배송문의/배송조회"
                    customerCity: "경기도 수원시"
                    customerGrade: "일반"
                    channelTalkUserId: null
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174013"
                    createdAt: "2025-11-04T11:45:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174002"
                    tagName: "상품문의/교환/사이즈"
                    customerCity: "광주광역시"
                    customerGrade: "VIP"
                    channelTalkUserId: "ch_010"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174006"
                    createdAt: "2025-11-03T12:25:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174005"
                    tagName: "상품문의/재고/입고문의"
                    customerCity: "대전광역시"
                    customerGrade: null
                    channelTalkUserId: "ch_005"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174014"
                    createdAt: "2025-11-03T16:40:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174001"
                    tagName: "결제문의/환불"
                    customerCity: "서울특별시"
                    customerGrade: "일반"
                    channelTalkUserId: "ch_011"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174007"
                    createdAt: "2025-11-02T17:55:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174006"
                    tagName: "상품문의/교환/불량"
                    customerCity: "광주광역시"
                    customerGrade: "일반"
                    channelTalkUserId: "ch_006"
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174015"
                    createdAt: "2025-11-02T11:05:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174007"
                    tagName: "결제문의/쿠폰"
                    customerCity: "부산광역시"
                    customerGrade: null
                    channelTalkUserId: null
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174008"
                    createdAt: "2025-11-01T09:41:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174007"
                    tagName: "결제문의/쿠폰"
                    customerCity: "울산광역시"
                    customerGrade: null
                    channelTalkUserId: null
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174009"
                    createdAt: "2025-10-31T20:03:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174001"
                    tagName: "결제문의/환불"
                    customerCity: "서울특별시"
                    customerGrade: "VIP"
                    channelTalkUserId: "ch_007"
                  - inquiryId: "111e4567-e89b-12d3-a456-42661417400a"
                    createdAt: "2025-10-30T11:22:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174000"
                    tagName: "배송문의/배송지연"
                    customerCity: "경기도 고양시"
                    customerGrade: "일반"
                    channelTalkUserId: null
                  - inquiryId: "111e4567-e89b-12d3-a456-42661417400b"
                    createdAt: "2025-10-29T09:18:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174004"
                    tagName: "배송문의/배송조회"
                    customerCity: "대구광역시"
                    customerGrade: "일반"
                    channelTalkUserId: "ch_012"
                  - inquiryId: "111e4567-e89b-12d3-a456-42661417400c"
                    createdAt: "2025-10-28T14:50:00Z"
                    tagId: "aaa14567-e89b-12d3-a456-426614174003"
                    tagName: "이벤트/포인트"
                    customerCity: "서울특별시"
                    customerGrade: null
                    channelTalkUserId: "ch_013"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /stats/inquiries/summary:
    get:
      summary: "문의 요약 지표"
      description: "기간 내 문의 총 건수 등의 주요 지표를 반환합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: start
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 시작 일시 (기본값: 지금으로부터 30일 전)"
        - in: query
          name: end
          schema:
            type: string
            format: date-time
          required: false
          description: "조회 종료 일시 (기본값: 현재 시각)"
      responses:
        '200':
          description: "요약 지표 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InquirySummaryResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /inquiries & /tags
  # ---------------------------------------------
  /inquiries:
    get:
      summary: "문의 리스트 조회"
      description: "아카이빙된 문의 리스트를 조회합니다. (페이지네이션 지원)"
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            format: int32
            default: 1
          required: false
          description: "페이지 번호"
        - in: query
          name: limit
          schema:
            type: integer
            format: int32
            default: 20
          required: false
          description: "페이지 당 항목 수"
      responses:
        '200':
          description: "문의 리스트 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedInquiriesResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    
    post:
      summary: Create inquiry
      operationId: inquiriesPost
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InquiryCreateRequest'
      responses:
        '201':
          description: Created
          headers:
            Location:
              description: Resource URL
              schema: { type: string, format: uri }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InquiryResponse'
        '400':
          description: Bad request

  /inquiries/analyze:
    post:
      summary: "채팅 메시지 LLM 분석"
      description: |
        채팅 메시지를 LLM으로 분석하여 부서 분류, 요약, 주요 피드백을 추출합니다.
        이 API는 문의 생성 전에 미리 분석 결과를 확인하거나, 별도로 분석이 필요한 경우 사용합니다.
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatAnalysisRequest"
      responses:
        '200':
          description: "LLM 분석 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatAnalysisResponse"
        '400':
          description: "잘못된 요청 (chatMessages가 비어있거나 형식 오류)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '500':
          description: "LLM 분석 실패 (OpenAI API 오류 등)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /inquiries/{inquiryId}:
    get:
      summary: "문의 상세 조회"
      description: "특정 문의의 상세 내용을 조회합니다. (DB에 저장된 채팅 내용 등)"
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          schema:
            type: string
            format: uuid
          required: true
          description: "조회할 문의의 고유 ID"
      responses:
        '200':
          description: "문의 상세 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InquiryDetail"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "문의를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INQUIRY_NOT_FOUND"
                  message: "해당 문의를 찾을 수 없습니다."

  /tags/config:
    get:
      summary: "유효한 태그 목록 조회"
      description: "사용자가 노션에 기록하도록 설정한 '유효한 태그' 목록을 조회합니다."
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "태그 설정 조회 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example: ["긴급", "환불", "AS", "신규"]
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    
    put:
      summary: "유효한 태그 목록 업데이트"
      description: "'유효한 태그' 목록 전체를 업데이트합니다."
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      requestBody:
        description: "새로 설정할 태그 목록"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TagsConfigRequest"
      responses:
        '200':
          description: "태그 설정 업데이트 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example: ["긴급", "환불", "AS", "신규", "배송문의"]
        '400':
          description: "잘못된 요청 (예: 배열 형식이 아님)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /notion
  # ---------------------------------------------
  /notion/databases:
    post:
      summary: "노션 데이터베이스 생성"
      description: |
        노션의 특정 페이지 하위에 새 데이터베이스를 생성합니다.
        (주로 Oauth 연동 직후, 최초 1회 설정 시 사용됩니다.)
      tags: ["Notion"]
      security:
        - bearerAuth: []
      requestBody:
        description: "생성할 데이터베이스의 정보"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotionDatabaseRequest"
      responses:
        '201':
          description: "데이터베이스 생성 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionDatabaseResponse"
        '400':
          description: "잘못된 요청 (예: parentPageId가 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "상위 페이지(parentPage)를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notion/databases/{databaseId}/pages:
    post:
      summary: "노션 데이터베이스에 페이지(행) 추가"
      description: |
        지정된 노션 데이터베이스에 새 행(페이지)을 추가합니다.
        (참고: 이 API는 주로 서버의 /webhooks/channel-talk 핸들러에 의해 내부적으로 호출됩니다.)
      tags: ["Notion"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: databaseId
          schema:
            type: string
          required: true
          description: "데이터가 추가될 노션 DB ID"
      requestBody:
        description: "페이지 속성(properties) 및 내용(content)"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotionPageRequest"
      responses:
        '201':
          description: "페이지 생성 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionPageResponse"
        '400':
          description: "잘못된 요청 (예: databaseId가 유효하지 않거나, 요청 본문 스키마 오류)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "데이터베이스를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notion/pages/{pageId}:
    get:
      summary: "노션 페이지 조회"
      description: "특정 노션 페이지의 정보를 조회합니다."
      tags: ["Notion"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: pageId
          schema:
            type: string
          required: true
          description: "조회할 노션 페이지 ID"
      responses:
        '200':
          description: "페이지 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionPageResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "페이지를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    patch:
      summary: "노션 페이지 수정"
      description: "특정 노션 페이지의 속성을 수정합니다."
      tags: ["Notion"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: pageId
          schema:
            type: string
          required: true
          description: "수정할 노션 페이지 ID"
      requestBody:
        description: "수정할 페이지 속성"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotionPageRequest"
            example:
              properties:
                title:
                  title:
                    - text:
                        content: "업데이트된 제목"
      responses:
        '200':
          description: "페이지 수정 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionPageResponse"
        '400':
          description: "잘못된 요청"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "페이지를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notion/pages:
    post:
      summary: "노션 페이지 생성"
      description: "새로운 노션 페이지를 생성합니다."
      tags: ["Notion"]
      security:
        - bearerAuth: []
      requestBody:
        description: "생성할 페이지 정보"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotionPageRequest"
            example:
              parent:
                type: "page_id"
                page_id: "id"
              properties:
                title:
                  title:
                    - text:
                        content: "생성한 페이지"
              children:
                - object: "block"
                  type: "paragraph"
                  paragraph:
                    rich_text:
                      - type: "text"
                        text:
                          content: "제목"
      responses:
        '201':
          description: "페이지 생성 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionPageResponse"
        '400':
          description: "잘못된 요청"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /api/notion/oauth
  # ---------------------------------------------
  /api/notion/oauth/login:
    get:
      summary: "Notion OAuth 로그인"
      description: "Notion OAuth 인증 프로세스를 시작하기 위한 Authorization URL을 생성합니다."
      operationId: notionOAuthLogin
      tags: ["Notion OAuth"]
      parameters:
        - name: userId
          in: query
          required: true
          description: "인증을 요청하는 사용자의 고유 식별자"
          schema:
            type: string
            format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: "Authorization URL 생성 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  authorizationUrl:
                    type: string
                    format: uri
                    description: "사용자가 리다이렉트되어야 하는 Notion OAuth 인증 URL"
                    example: "https://api.notion.com/v1/oauth/authorize?client_id={CLIENT_ID}&response_type=code&owner=user&redirect_uri={REDIRECT_URI}&state={ENCODED_STATE}"
                  message:
                    type: string
                    description: "안내 메시지"
                    example: "Redirect user to this URL to authorize"
                required: [authorizationUrl, message]
              examples:
                success:
                  summary: 성공 응답 예시
                  value:
                    authorizationUrl: "https://api.notion.com/v1/oauth/authorize?client_id=abc123&response_type=code&owner=user&redirect_uri=http://localhost:8080/api/notion/oauth/callback&state=MTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAw"
                    message: "Redirect user to this URL to authorize"
        '400':
          description: "잘못된 요청 (유효하지 않은 UUID 형식)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidUuid:
                  summary: 잘못된 UUID 형식
                  value:
                    error: "Bad Request"
                    message: "Invalid UUID format"
                    timestamp: "2024-11-07T23:53:52.172+09:00"

  /api/notion/oauth/callback:
    get:
      summary: "Notion OAuth 콜백"
      description: "Notion에서 인증 후 리다이렉트되는 엔드포인트"
      operationId: notionOAuthCallback
      tags: ["Notion OAuth"]
      parameters:
        - name: code
          in: query
          required: true
          description: "Notion에서 발급한 인증 코드"
          schema:
            type: string
          example: "abc123def456"
        - name: state
          in: query
          required: true
          description: "Base64 인코딩된 userId (CSRF 방지용)"
          schema:
            type: string
          example: "MTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAw"
      responses:
        '200':
          description: "OAuth 인증 성공 및 토큰 저장 완료"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Notion OAuth authentication successful"
                  userId:
                    type: string
                    format: uuid
                    example: "123e4567-e89b-12d3-a456-426614174000"
        '400':
          description: "잘못된 요청"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/notion/oauth/status:
    get:
      summary: "Notion 연동 상태 확인"
      description: "사용자의 Notion 연동 상태를 확인합니다."
      operationId: notionOAuthStatus
      tags: ["Notion OAuth"]
      parameters:
        - name: userId
          in: query
          required: true
          description: "확인할 사용자의 고유 식별자"
          schema:
            type: string
            format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: "연동 상태 조회 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                    format: uuid
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  isConnected:
                    type: boolean
                    description: "Notion 연동 여부"
                    example: true
                  connectedAt:
                    type: string
                    format: date-time
                    description: "연동 시간 (연동된 경우)"
                    example: "2024-11-07T23:53:52.172+09:00"
        '404':
          description: "사용자를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /webhooks
  # ---------------------------------------------
  /webhooks/channel-talk:
    post:
      summary: "채널톡 웹훅 수신"
      description: |
        채널톡에서 '채팅 종료'와 같은 이벤트가 발생했을 때 호출되는 엔드포인트입니다.
        이 API는 공개되어 있어야 하며, X-Channel-Signature 헤더를 통해 요청의 유효성을 검증해야 합니다.
      tags: ["Webhooks"]
      parameters:
        - in: header
          name: X-Channel-Signature 
          schema:
            type: string
          required: false
          description: "채널톡에서 요청 유효성 검증을 위해 보내는 시그니처"
      requestBody:
        description: "채널톡에서 전송하는 Webhook Payload"
        required: true
        content:
          application/json:
            schema:
              type: object
              description: "채널톡 Webhook 이벤트 페이로드 스키마"
              example: {
                "event": "chat_ended",
                "payload": {
                  "chatId": "12345",
                  "tags": ["환불", "긴급"],
                  "messages": [...]
                }
              }
      responses:
        '200':
          description: "웹훅 수신 성공 (비동기 처리를 위해 즉시 응답)"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          description: "잘못된 페이로드 (요청 본문이 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패 (X-Channel-Signature가 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INVALID_SIGNATURE"
                  message: "유효하지 않은 웹훅 시그니처입니다."

    /api/notion/oauth/login:
    get:
      summary: Notion OAuth 로그인
      description: Notion OAuth 인증 프로세스를 시작하기 위한 Authorization URL을 생성합니다.
      operationId: notionOAuthLogin
      tags:
        - Notion OAuth
      parameters:
        - name: userId
          in: query
          required: true
          description: 인증을 요청하는 사용자의 고유 식별자
          schema:
            type: string
            format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: Authorization URL 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  authorizationUrl:
                    type: string
                    format: uri
                    description: 사용자가 리다이렉트되어야 하는 Notion OAuth 인증 URL
                    example: >-
                      https://api.notion.com/v1/oauth/authorize?client_id={CLIENT_ID}&response_type=code&owner=user&redirect_uri={REDIRECT_URI}&state={ENCODED_STATE}
                  message:
                    type: string
                    description: 안내 메시지
                    example: Redirect user to this URL to authorize
                required:
                  - authorizationUrl
                  - message
              examples:
                success:
                  summary: 성공 응답 예시
                  value:
                    authorizationUrl: >-
                      https://api.notion.com/v1/oauth/authorize?client_id=abc123&response_type=code&owner=user&redirect_uri=http://localhost:8080/api/notion/oauth/callback&state=MTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAw
                    message: Redirect user to this URL to authorize
        '400':
          description: 잘못된 요청 (유효하지 않은 UUID 형식)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidUuid:
                  summary: 잘못된 UUID 형식
                  value:
                    error: Bad Request
                    message: Invalid UUID format
                    timestamp: 2024-11-07T23:53:52.172+09:00

  /api/notion/oauth/callback:
    get:
      summary: Notion OAuth 콜백
      description: Notion에서 인증 후 리다이렉트되는 엔드포인트
      operationId: notionOAuthCallback
      tags:
        - Notion OAuth
      parameters:
        - name: code
          in: query
          required: true
          description: Notion에서 발급한 인증 코드
          schema:
            type: string
          example: abc123def456
        - name: state
          in: query
          required: true
          description: Base64 인코딩된 userId (CSRF 방지용)
          schema:
            type: string
          example: MTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAw
      responses:
        '200':
          description: OAuth 인증 성공 및 토큰 저장 완료
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Notion OAuth authentication successful
                  userId:
                    type: string
                    format: uuid
                    example: 123e4567-e89b-12d3-a456-426614174000
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/notion/oauth/status:
    get:
      summary: Notion 연동 상태 확인
      description: 사용자의 Notion 연동 상태를 확인합니다.
      operationId: notionOAuthStatus
      tags:
        - Notion OAuth
      parameters:
        - name: userId
          in: query
          required: true
          description: 확인할 사용자의 고유 식별자
          schema:
            type: string
            format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: 연동 상태 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                    format: uuid
                    example: 123e4567-e89b-12d3-a456-426614174000
                  isConnected:
                    type: boolean
                    description: Notion 연동 여부
                    example: true
                  connectedAt:
                    type: string
                    format: date-time
                    description: 연동 시간 (연동된 경우)
                    example: 2024-11-07T23:53:52.172+09:00
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'    

# ===============================================
# 2. Reusable Components (재사용 가능한 정의)
# ===============================================
components:
  # ---------------------------------------------
  # Security Schemes
  # ---------------------------------------------
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    channelTalkSignature:
      type: apiKey
      in: header
      name: X-Channel-Signature
      description: "채널톡 웹훅의 유효성 검증을 위한 시그니처"

  # ---------------------------------------------
  # Schemas (Data Models)
  # ---------------------------------------------
  schemas:
    # Common
    ErrorResponse:
      type: object
      description: "공통 에러 응답 모델"
      properties:
        error:
          type: string
          description: "에러 코드"
        message:
          type: string
          description: "에러 상세 메시지"

    # Auth
    AuthTokens:
      type: object
      description: "로그인 성공 시 발급되는 토큰"
      properties:
        accessToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          example: "def456..."

    User:
      type: object
      description: "사용자 정보 모델"
      properties:
        userId:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        email:
          type: string
          format: email
          example: "user@example.com"
        name:
          type: string
          example: "홍길동"

    # Integrations
    ChannelTalkRequest:
      type: object
      description: "채널톡 API Key 등록 요청"
      properties:
        apiKey:
          type: string
          description: "사용자가 발급받은 채널톡 Access Key"
          example: "ch-access-key-..."
        apiSecret:
          type: string
          description: "사용자가 발급받은 채널톡 Access Secret"
          example: "ch-access-secret-..."
      required:
        - apiKey
        - apiSecret

    NotionStatusResponse:
      type: object
      description: "노션 연동 상태 응답"
      properties:
        connected:
          type: boolean
          example: true
        workspaceName:
          type: string
          example: "홍길동의 워크스페이스"
        workspaceUrl:
          type: string
          format: uri
          example: "https://www.notion.so/..."
      required:
        - connected

    # Statistics
    DateRange:
      type: object
      description: "조회 기간"
      properties:
        start:
          type: string
          format: date-time
          description: "시작 일시"
        end:
          type: string
          format: date-time
          description: "종료 일시"
      required: [start, end]

    TagStatItem:
      type: object
      description: "태그별 문의 수"
      properties:
        tagId:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        tagName:
          type: string
          example: "배송"
        count:
          type: integer
          format: int32
          example: 15
      required: [tagId, tagName, count]

    TagStatListResponse:
      type: object
      description: "태그 통계 응답"
      properties:
        range:
          $ref: "#/components/schemas/DateRange"
        items:
          type: array
          items:
            $ref: "#/components/schemas/TagStatItem"
      required: [range, items]

    RegionDistributionItem:
      type: object
      description: "도시별 문의 수"
      properties:
        city:
          type: string
          example: "서울특별시"
        count:
          type: integer
          format: int32
          example: 42
        ratio:
          type: number
          format: double
          example: 0.35
      required: [city, count]

    RegionDistributionResponse:
      type: object
      description: "고객 지역 분포"
      properties:
        range:
          $ref: "#/components/schemas/DateRange"
        total:
          type: integer
          format: int32
          description: "전체 문의 수"
          example: 120
        items:
          type: array
          items:
            $ref: "#/components/schemas/RegionDistributionItem"
      required: [range, total, items]

    InquiryRawItem:
      type: object
      description: "다차원 분석용 원자료 행"
      properties:
        inquiryId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        tagId:
          type: string
          format: uuid
        tagName:
          type: string
        customerCity:
          type: string
          nullable: true
        customerGrade:
          type: string
          nullable: true
        channelTalkUserId:
          type: string
          nullable: true
      required: [inquiryId, createdAt, tagId, tagName]

    InquiryRawResponse:
      type: object
      description: "다차원 분석 원자료 응답"
      properties:
        range:
          $ref: "#/components/schemas/DateRange"
        items:
          type: array
          items:
            $ref: "#/components/schemas/InquiryRawItem"
      required: [range, items]

    InquirySummaryResponse:
      type: object
      description: "문의 요약 지표"
      properties:
        range:
          $ref: "#/components/schemas/DateRange"
        totalInquiries:
          type: integer
          format: int32
          example: 257
      required: [range, totalInquiries]

    # Inquiries & Tags
    InquiryStatus:
      type: string
      enum: [NEW, IN_PROGRESS, DONE]
      description: 신규, 처리중, 처리완료
    InquiryCreateRequest:
      type: object
      required: [title, requesterId]
      properties:
        title: { type: string, maxLength: 200 }
        tagIds:
          type: array
          items: { type: string, format: uuid }
        status:
          $ref: '#/components/schemas/InquiryStatus'
          default: NEW
        requesterId: { type: string, format: uuid }
        assigneeIds:
          type: array
          items: { type: string, format: uuid }
        summary: { type: string, maxLength: 2000 }
        keyFeedback: { type: string, maxLength: 4000 }
        channelTalkUrl: { type: string, format: uri }
        notionPageUrl: { type: string, format: uri }
        departmentIds:
          type: array
          items: { type: string, format: uuid }
        chatMessages:
          type: array
          description: "채팅 메시지 목록 (LLM 분석용). 채널톡 API 응답에서 필요한 필드만 추출하여 전달합니다."
          items:
            $ref: '#/components/schemas/ChatMessage'
    InquiryResponse:
      type: object
      properties:
        inquiryId: { type: string, format: uuid }
        title: { type: string }
        tagIds:
          type: array
          items: { type: string, format: uuid }
        status: { $ref: '#/components/schemas/InquiryStatus' }
        requesterId: { type: string, format: uuid }
        assigneeIds:
          type: array
          items: { type: string, format: uuid }
        summary: { type: string }
        keyFeedback: { type: string }
        channelTalkUrl: { type: string, format: uri }
        notionPageUrl: { type: string, format: uri }
        departmentIds:
          type: array
          items: { type: string, format: uuid }
        createdAt: { type: string, format: date-time }

    InquirySummary:
      type: object
      description: "문의 리스트의 개별 항목 (요약)"
      properties:
        inquiryId:
          type: string
          format: uuid
        userName:
          type: string
          example: "고객명"
        tags:
          type: array
          items:
            type: string
          example: ["환불", "긴급"]
        createdAt:
          type: string
          format: date-time
          example: "2025-11-06T02:00:00Z"
      required:
        - inquiryId
        - createdAt

    PaginationInfo:
      type: object
      description: "페이지네이션 정보"
      properties:
        currentPage:
          type: integer
          format: int32
          example: 1
        totalCount:
          type: integer
          format: int32
          example: 150
        totalPages:
          type: integer
          format: int32
          example: 8
      required:
        - currentPage
        - totalCount
        - totalPages

    PaginatedInquiriesResponse:
      type: object
      description: "페이지네이션이 적용된 문의 리스트 응답"
      properties:
        pagination:
          $ref: "#/components/schemas/PaginationInfo"
        data:
          type: array
          items:
            $ref: "#/components/schemas/InquirySummary"
      required:
        - pagination
        - data

    InquiryDetail:
      type: object
      description: "문의 상세 정보"
      properties:
        inquiryId:
          type: string
          format: uuid
        userName:
          type: string
          example: "고객명"
        tags:
          type: array
          items:
            type: string
          example: ["환불", "긴급"]
        createdAt:
          type: string
          format: date-time
        notionPageUrl:
          type: string
          format: uri
          example: "https://www.notion.so/..."
        chatHistory:
          type: array
          items:
            $ref: "#/components/schemas/ChatMessage"
      required:
        - inquiryId
        - createdAt

    ChatMessage:
      type: object
      description: "채팅 메시지"
      properties:
        sender:
          type: string
          enum: [user, agent, system]
          example: "user"
        message:
          type: string
          example: "배송 언제되나요?"
        timestamp:
          type: string
          format: date-time
      required:
        - sender
        - message
        - timestamp

    ChatAnalysisRequest:
      type: object
      description: "채팅 메시지 LLM 분석 요청"
      properties:
        chatMessages:
          type: array
          description: "분석할 채팅 메시지 목록"
          items:
            $ref: "#/components/schemas/ChatMessage"
          minItems: 1
      required:
        - chatMessages

    ChatAnalysisResponse:
      type: object
      description: "LLM 분석 결과"
      properties:
        department:
          type: array
          description: "관련 부서 목록"
          items:
            type: string
          example: ["개발팀", "운영팀"]
        generalSummary:
          type: string
          description: "중립적인 한 줄 요약"
          example: "사용자 로그인 시 간헐적으로 오류가 발생하여 문의함"
        summary:
          type: string
          description: "문의 요약 (200자 이내)"
          example: "로그인 버튼 클릭 시 반응 없음 (크롬 브라우저)"
        keyFeedback:
          type: string
          description: "주요 피드백"
          example: "로그인 버튼 클릭 시 서버 에러 발생, 콘솔에 500 Internal Server Error 확인"
      required:
        - department
        - summary

    TagsConfigRequest:
      type: object
      description: "태그 설정 요청 본문"
      properties:
        tags:
          type: array
          items:
            type: string
          example: ["긴급", "환불", "AS", "신규", "배송문의"]
      required:
        - tags

    # Notion
    NotionDatabaseRequest:
      type: object
      description: "노션 DB 생성 요청"
      properties:
        parentPageId:
          type: string
          description: "데이터베이스가 생성될 상위 페이지의 ID"
          example: "123e4567-e89b-12d3-a456-426614174000"
        title:
          type: string
          description: "새 데이터베이스의 제목"
          example: "고객 문의 아카이브"
      required:
        - parentPageId
        - title

    NotionDatabaseResponse:
      type: object
      description: "노션 DB 생성 응답"
      properties:
        databaseId:
          type: string
          description: "생성된 데이터베이스의 ID"
          example: "789e4567-e89b-12d3-a456-426614174aaa"
        databaseUrl:
          type: string
          format: uri
          description: "생성된 데이터베이스의 URL"
          example: "https://www.notion.so/..."
      required:
        - databaseId
        - databaseUrl

    NotionPageRequest:
      type: object
      description: "노션 페이지(행) 생성 요청"
      properties:
        properties:
          type: object
          description: "노션 DB의 속성(컬럼)에 맞게 매핑된 데이터"
          example: {
            "문의일시": { "date": { "start": "2025-11-06T13:00:00Z" } },
            "고객명": { "title": [ { "text": { "content": "홍길동" } } ] },
            "태그": { "multi_select": [ { "name": "환불" }, { "name": "긴급" } ] }
          }
        content:
          type: array
          description: "페이지 본문에 추가될 블록(채팅 내용)"
          items:
            type: object
          example: [
            {
              "object": "block",
              "type": "heading_2",
              "heading_2": { "rich_text": [ { "text": { "content": "채팅 내용" } } ] }
            },
            {
              "object": "block",
              "type": "paragraph",
              "paragraph": { "rich_text": [ { "text": { "content": "고객: 안녕하세요..." } } ] }
            }
          ]
      required:
        - properties

    NotionPageResponse:
      type: object
      description: "노션 페이지(행) 생성 응답"
      properties:
        pageId:
          type: string
          description: "생성된 페이지의 ID"
          example: "abc-123..."
        pageUrl:
          type: string
          format: uri
          description: "생성된 페이지의 URL"
          example: "https://www.notion.so/..."
      required:
        - pageId
        - pageUrl