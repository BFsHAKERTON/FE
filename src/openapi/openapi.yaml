# yaml
openapi: 3.0.1
info:
  title: "Channel-Talk Notion Integration API"
  description: "채널톡과 노션을 연동하는 서비스 API 명세"
  version: "1.0.0"

# ===============================================
# 1. API Paths (엔드포인트 정의)
# ===============================================
paths:
  # ---------------------------------------------
  # /auth
  # ---------------------------------------------
  /auth/kakao:
    get:
      summary: "카카오 로그인 시작"
      description: "사용자를 카카오 인증 페이지로 리디렉션합니다. redirectUri를 지정하면 로그인 완료 후 해당 URL로 리디렉션됩니다."
      tags: ["Authentication"]
      parameters:
        - in: query
          name: redirectUri
          schema:
            type: string
            format: uri
          required: false
          description: "로그인 완료 후 리디렉션할 URL (없으면 기본값 사용)"
      responses:
        '302':
          description: "카카오 인증 페이지로 리디렉션"
          headers:
            Location:
              description: "카카오 인증 URL"
              schema:
                type: string
                format: uri

  /auth/kakao/callback:
    get:
      summary: "카카오 로그인 콜백"
      description: "카카오 인증 성공 후, HTML 페이지를 반환하여 토큰을 localStorage에 저장하고 지정된 URL로 리디렉션합니다."
      tags: ["Authentication"]
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: false
          description: "카카오에서 발급한 1회용 인증 코드"
        - in: query
          name: error
          schema:
            type: string
          required: false
          description: "인증 실패 시 에러 코드 (예: access_denied)"
        - in: query
          name: state
          schema:
            type: string
          required: false
          description: "로그인 시작 시 전달한 redirectUri (인코딩된 상태)"
      responses:
        '200':
          description: "로그인 성공, HTML 페이지 반환 (토큰 저장 후 리디렉션)"
          content:
            text/html:
              schema:
                type: string
                example: "<html><body><script>localStorage.setItem('accessToken', '...'); window.location.href='...';</script></body></html>"
        '400':
          description: "유효하지 않은 요청 (예: code 누락, 유효하지 않은 code)"
          content:
            text/html:
              schema:
                type: string
                example: "<html><body><script>window.location.href='...?error=INVALID_KAKAO_CODE';</script></body></html>"

  /auth/me:
    get:
      summary: "내 정보 조회"
      description: "현재 로그인된 사용자의 정보를 조회합니다. (AccessToken 필요)"
      tags: ["Authentication"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "사용자 정보 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
              example:
                userId: "123e4567-e89b-12d3-a456-426614174000"
                email: "user@example.com"
                name: "홍길동"
        '401':
          description: "인증 실패 (토큰 누락, 만료, 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "UNAUTHORIZED"
                  message: "인증이 필요합니다."
        '404':
          description: "사용자 없음 (토큰은 유효하나 DB에 사용자 없음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "USER_NOT_FOUND"
                  message: "사용자를 찾을 수 없습니다."

  /auth/mock/login:
    post:
      summary: "Mock 로그인"
      description: "목 개발용. accessToken/refreshToken을 즉시 발급합니다."
      tags: ["Authentication"]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                email:
                  oneOf:
                    - type: string
                      format: email
                    - type: string
                      enum: ['']
                password:
                  type: string
              example: {}
      responses:
        '200':
          description: "로그인 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
              examples:
                default:
                  value:
                    accessToken: "mock-access"
                    refreshToken: "mock-refresh"

  # ---------------------------------------------
  # /integrations
  # ---------------------------------------------
  /integrations/channel-talk:
    post:
      summary: "채널톡 API Key 등록"
      description: "사용자의 채널톡 API Key를 등록하고 유효성을 검사합니다."
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      requestBody:
        description: "채널톡 API Key"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChannelTalkRequest"
      responses:
        '200':
          description: "채널톡 연동 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "채널톡 연동에 성공했습니다."
        '400':
          description: "유효하지 않은 API Key"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INVALID_CHANNEL_TALK_KEY"
                  message: "유효하지 않은 채널톡 API Key입니다."
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /integrations/notion/connect:
    get:
      summary: "노션 Oauth 연동 시작"
      description: "노션 Oauth 연동을 시작하기 위해 사용자를 노션 승인 페이지로 리디렉션합니다."
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      responses:
        '302':
          description: "노션 Oauth 승인 페이지로 리디렉션"
          headers:
            Location:
              description: "노션 Oauth URL"
              schema:
                type: string
                format: uri

  /integrations/notion/callback:
    get:
      summary: "노션 Oauth 콜백"
      description: "노션 Oauth 승인 후, 리디렉션되는 콜백 URL입니다. 서버는 토큰을 발급받아 저장합니다."
      tags: ["IntegrATIONS"]
      parameters:
        - in: query
          name: code
          schema:
            type: string
          required: true
          description: "노션에서 발급한 1회용 인증 코드"
        - in: query
          name: error
          schema:
            type: string
          required: false
          description: "인증 실패 시 (예: access_denied)"
      responses:
        '200':
          description: "연동 성공. (성공 페이지로 리디렉션 또는 스크립트)"
          content:
            text/html:
              schema:
                type: string
                example: "<html><body>연동에 성공했습니다. 창을 닫아주세요.</body></html>"
        '400':
          description: "유효하지 않은 요청 (code 누락 등)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INVALID_NOTION_CODE"
                  message: "유효하지 않은 노션 인증 코드입니다."

  /integrations/notion/status:
    get:
      summary: "노션 연동 상태 조회"
      description: "현재 노션 연동 상태, 연결된 워크스페이스 이름, 링크 등을 조회합니다."
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "연동 상태 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionStatusResponse"
              example:
                connected: true
                workspaceName: "홍길동의 워크스페이스"
                workspaceUrl: "https://www.notion.so/..."
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "노션이 아직 연동되지 않았습니다."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "NOTION_NOT_CONNECTED"
                  message: "노션이 아직 연동되지 않았습니다."

  /integrations/notion:
    delete:
      summary: "노션 연동 해제"
      description: "노션 연동을 해제합니다. (서버에 저장된 토큰 삭제)"
      tags: ["Integrations"]
      security:
        - bearerAuth: []
      responses:
        '204':
          description: "연동 해제 성공. 응답 본문 없음."
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /stats
  # ---------------------------------------------
  /stats/keywords/weekly:
    get:
      summary: "이번 주 핫 키워드 조회"
      description: "이번 주 '핫 키워드'(태그) 목록을 빈도수 순서대로 조회합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            format: int32
            default: 10
          required: false
          description: "조회할 최대 키워드 수"
      responses:
        '200':
          description: "핫 키워드 조회 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/KeywordStat"
              example:
                - { keyword: "환불", count: 120 }
                - { keyword: "배송", count: 98 }
                - { keyword: "AS", count: 74 }
                - { keyword: "지연", count: 63 }
                - { keyword: "교환", count: 52 }
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /stats/inquiries/hourly-today:
    get:
      summary: "금일 시간대별 문의 수 조회"
      description: "금일 0시부터 현재 시간까지의 시간대별 문의 수를 조회합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "시간대별 문의 수 조회 성공"
          content:
            application/json:
              schema:
                type: array
                minItems: 5
                items:
                  $ref: "#/components/schemas/HourlyStat"
              example:
                - { hour: 9, count: 12 }
                - { hour: 10, count: 15 }
                - { hour: 11, count: 20 }
                - { hour: 12, count: 18 }
                - { hour: 13, count: 22 }
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /stats/inquiries/total-weekly:
    get:
      summary: "이번 주 총 문의 수 조회"
      description: "이번 주(예: 월요일~일요일)의 총 문의 수를 조회합니다."
      tags: ["Statistics"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "총 문의 수 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TotalStatsResponse"
              example:
                totalCount: 120
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /inquiries & /tags
  # ---------------------------------------------
  /inquiries:
    get:
      summary: "문의 리스트 조회"
      description: "아카이빙된 문의 리스트를 조회합니다. (페이지네이션 지원)"
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            format: int32
            default: 1
          required: false
          description: "페이지 번호"
        - in: query
          name: limit
          schema:
            type: integer
            format: int32
            default: 20
          required: false
          description: "페이지 당 항목 수"
      responses:
        '200':
          description: "문의 리스트 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedInquiriesResponse"
              example:
                pagination:
                  currentPage: 1
                  totalCount: 2
                  totalPages: 1
                data:
                  - inquiryId: "111e4567-e89b-12d3-a456-426614174000"
                    userName: "고객A"
                    tags: ["환불", "긴급"]
                    createdAt: "2025-11-06T02:00:00Z"
                  - inquiryId: "222e4567-e89b-12d3-a456-426614174000"
                    userName: "고객B"
                    tags: ["배송"]
                    createdAt: "2025-11-06T03:00:00Z"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    
    post:
      summary: Create inquiry
      operationId: inquiriesPost
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InquiryCreateRequest'
      responses:
        '201':
          description: Created
          headers:
            Location:
              description: Resource URL
              schema: { type: string, format: uri }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InquiryResponse'
              example:
                inquiryId: "333e4567-e89b-12d3-a456-426614174000"
                title: "환불 요청"
                tagIds: []
                status: "NEW"
                requesterId: "123e4567-e89b-12d3-a456-426614174000"
                assigneeIds: []
                createdAt: "2025-11-06T02:10:00Z"
        '400':
          description: Bad request

  /inquiries/{inquiryId}:
    get:
      summary: "문의 상세 조회"
      description: "특정 문의의 상세 내용을 조회합니다. (DB에 저장된 채팅 내용 등)"
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: inquiryId
          schema:
            type: string
            format: uuid
          required: true
          description: "조회할 문의의 고유 ID"
      responses:
        '200':
          description: "문의 상세 조회 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InquiryDetail"
              example:
                inquiryId: "111e4567-e89b-12d3-a456-426614174000"
                userName: "고객A"
                tags: ["환불", "긴급"]
                createdAt: "2025-11-06T02:00:00Z"
                notionPageUrl: "https://www.notion.so/..."
                chatHistory:
                  - { sender: "user", message: "환불하고 싶어요", timestamp: "2025-11-06T02:01:00Z" }
                  - { sender: "agent", message: "도와드리겠습니다", timestamp: "2025-11-06T02:02:00Z" }
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "문의를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INQUIRY_NOT_FOUND"
                  message: "해당 문의를 찾을 수 없습니다."

  /tags/config:
    get:
      summary: "유효한 태그 목록 조회"
      description: "사용자가 노션에 기록하도록 설정한 '유효한 태그' 목록을 조회합니다."
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "태그 설정 조회 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                minItems: 5
                example: ["긴급", "환불", "AS", "신규"]
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    
    put:
      summary: "유효한 태그 목록 업데이트"
      description: "'유효한 태그' 목록 전체를 업데이트합니다."
      tags: ["Inquiries & Tags"]
      security:
        - bearerAuth: []
      requestBody:
        description: "새로 설정할 태그 목록"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TagsConfigRequest"
      responses:
        '200':
          description: "태그 설정 업데이트 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                minItems: 5
                example: ["긴급", "환불", "AS", "신규", "배송문의"]
        '400':
          description: "잘못된 요청 (예: 배열 형식이 아님)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /notion
  # ---------------------------------------------
  /notion/databases:
    post:
      summary: "노션 데이터베이스 생성"
      description: |
        노션의 특정 페이지 하위에 새 데이터베이스를 생성합니다.
        (주로 Oauth 연동 직후, 최초 1회 설정 시 사용됩니다.)
      tags: ["Notion"]
      security:
        - bearerAuth: []
      requestBody:
        description: "생성할 데이터베이스의 정보"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotionDatabaseRequest"
      responses:
        '201':
          description: "데이터베이스 생성 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionDatabaseResponse"
              example:
                databaseId: "789e4567-e89b-12d3-a456-426614174aaa"
                databaseUrl: "https://www.notion.so/..."
        '400':
          description: "잘못된 요청 (예: parentPageId가 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "상위 페이지(parentPage)를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notion/databases/{databaseId}/pages:
    post:
      summary: "노션 데이터베이스에 페이지(행) 추가"
      description: |
        지정된 노션 데이터베이스에 새 행(페이지)을 추가합니다.
        (참고: 이 API는 주로 서버의 /webhooks/channel-talk 핸들러에 의해 내부적으로 호출됩니다.)
      tags: ["Notion"]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: databaseId
          schema:
            type: string
          required: true
          description: "데이터가 추가될 노션 DB ID"
      requestBody:
        description: "페이지 속성(properties) 및 내용(content)"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotionPageRequest"
      responses:
        '201':
          description: "페이지 생성 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotionPageResponse"
              example:
                pageId: "abc-123"
                pageUrl: "https://www.notion.so/..."
        '400':
          description: "잘못된 요청 (예: databaseId가 유효하지 않거나, 요청 본문 스키마 오류)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '404':
          description: "데이터베이스를 찾을 수 없음"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ---------------------------------------------
  # /webhooks
  # ---------------------------------------------
  /webhooks/channel-talk:
    post:
      summary: "채널톡 웹훅 수신"
      description: |
        채널톡에서 '채팅 종료'와 같은 이벤트가 발생했을 때 호출되는 엔드포인트입니다.
        이 API는 공개되어 있어야 하며, X-Channel-Signature 헤더를 통해 요청의 유효성을 검증해야 합니다.
      tags: ["Webhooks"]
      security:
        - channelTalkSignature: []
      parameters:
        - in: header
          name: X-Channel-Signature 
          schema:
            type: string
          required: true
          description: "채널톡에서 요청 유효성 검증을 위해 보내는 시그니처"
      requestBody:
        description: "채널톡에서 전송하는 Webhook Payload"
        required: true
        content:
          application/json:
            schema:
              type: object
              description: "채널톡 Webhook 이벤트 페이로드 스키마"
              example: {
                "event": "chat_ended",
                "payload": {
                  "chatId": "12345",
                  "tags": ["환불", "긴급"],
                  "messages": [...]
                }
              }
      responses:
        '200':
          description: "웹훅 수신 성공 (비동기 처리를 위해 즉시 응답)"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          description: "잘못된 페이로드 (요청 본문이 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        '401':
          description: "인증 실패 (X-Channel-Signature가 유효하지 않음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                example:
                  error: "INVALID_SIGNATURE"
                  message: "유효하지 않은 웹훅 시그니처입니다."

# ===============================================
# 2. Reusable Components (재사용 가능한 정의)
# ===============================================
components:
  # ---------------------------------------------
  # Security Schemes
  # ---------------------------------------------
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    channelTalkSignature:
      type: apiKey
      in: header
      name: X-Channel-Signature
      description: "채널톡 웹훅의 유효성 검증을 위한 시그니처"

  # ---------------------------------------------
  # Schemas (Data Models)
  # ---------------------------------------------
  schemas:
    # Common
    ErrorResponse:
      type: object
      description: "공통 에러 응답 모델"
      properties:
        error:
          type: string
          description: "에러 코드"
        message:
          type: string
          description: "에러 상세 메시지"

    # Auth
    AuthTokens:
      type: object
      description: "로그인 성공 시 발급되는 토큰"
      properties:
        accessToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          example: "def456..."

    User:
      type: object
      description: "사용자 정보 모델"
      properties:
        userId:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        email:
          type: string
          format: email
          example: "user@example.com"
        name:
          type: string
          example: "홍길동"

    # Integrations
    ChannelTalkRequest:
      type: object
      description: "채널톡 API Key 등록 요청"
      properties:
        apiKey:
          type: string
          description: "사용자가 발급받은 채널톡 API Key"
          example: "ch-api-key-..."
      required:
        - apiKey

    NotionStatusResponse:
      type: object
      description: "노션 연동 상태 응답"
      properties:
        connected:
          type: boolean
          example: true
        workspaceName:
          type: string
          example: "홍길동의 워크스페이스"
        workspaceUrl:
          type: string
          format: uri
          example: "https://www.notion.so/..."
      required:
        - connected

    # Statistics
    KeywordStat:
      type: object
      description: "키워드 통계 항목"
      properties:
        keyword:
          type: string
          example: "환불"
        count:
          type: integer
          format: int32
          example: 120
      required:
        - keyword
        - count

    HourlyStat:
      type: object
      description: "시간대별 통계 항목"
      properties:
        hour:
          type: integer
          format: int32
          example: 9
        count:
          type: integer
          format: int32
          example: 55
      required:
        - hour
        - count

    TotalStatsResponse:
      type: object
      description: "총 문의 수 응답"
      properties:
        totalCount:
          type: integer
          format: int32
          example: 120
      required:
        - totalCount

    # Inquiries & Tags
    InquiryStatus:
      type: string
      enum: [NEW, IN_PROGRESS, DONE]
      description: 신규, 처리중, 처리완료
    InquiryCreateRequest:
      type: object
      required: [title, requesterId]
      properties:
        title: { type: string, maxLength: 200 }
        tagIds:
          type: array
          items: { type: string, format: uuid }
        status:
          $ref: '#/components/schemas/InquiryStatus'
          default: NEW
        requesterId: { type: string, format: uuid }
        assigneeIds:
          type: array
          items: { type: string, format: uuid }
        summary: { type: string, maxLength: 2000 }
        keyFeedback: { type: string, maxLength: 4000 }
        channelTalkUrl: { type: string, format: uri }
        notionPageUrl: { type: string, format: uri }
        departmentIds:
          type: array
          items: { type: string, format: uuid }
    InquiryResponse:
      type: object
      properties:
        inquiryId: { type: string, format: uuid }
        title: { type: string }
        tagIds:
          type: array
          items: { type: string, format: uuid }
        status: { $ref: '#/components/schemas/InquiryStatus' }
        requesterId: { type: string, format: uuid }
        assigneeIds:
          type: array
          items: { type: string, format: uuid }
        summary: { type: string }
        keyFeedback: { type: string }
        channelTalkUrl: { type: string, format: uri }
        notionPageUrl: { type: string, format: uri }
        departmentIds:
          type: array
          items: { type: string, format: uuid }
        createdAt: { type: string, format: date-time }

    InquirySummary:
      type: object
      description: "문의 리스트의 개별 항목 (요약)"
      properties:
        inquiryId:
          type: string
          format: uuid
        userName:
          type: string
          example: "고객명"
        tags:
          type: array
          items:
            type: string
          example: ["환불", "긴급"]
        createdAt:
          type: string
          format: date-time
          example: "2025-11-06T02:00:00Z"
      required:
        - inquiryId
        - createdAt

    PaginationInfo:
      type: object
      description: "페이지네이션 정보"
      properties:
        currentPage:
          type: integer
          format: int32
          example: 1
        totalCount:
          type: integer
          format: int32
          example: 150
        totalPages:
          type: integer
          format: int32
          example: 8
      required:
        - currentPage
        - totalCount
        - totalPages

    PaginatedInquiriesResponse:
      type: object
      description: "페이지네이션이 적용된 문의 리스트 응답"
      properties:
        pagination:
          $ref: "#/components/schemas/PaginationInfo"
        data:
          type: array
          minItems: 5
          items:
            $ref: "#/components/schemas/InquirySummary"
      required:
        - pagination
        - data

    InquiryDetail:
      type: object
      description: "문의 상세 정보"
      properties:
        inquiryId:
          type: string
          format: uuid
        userName:
          type: string
          example: "고객명"
        tags:
          type: array
          items:
            type: string
          example: ["환불", "긴급"]
        createdAt:
          type: string
          format: date-time
        notionPageUrl:
          type: string
          format: uri
          example: "https://www.notion.so/..."
        chatHistory:
          type: array
          items:
            $ref: "#/components/schemas/ChatMessage"
      required:
        - inquiryId
        - createdAt

    ChatMessage:
      type: object
      description: "채팅 메시지"
      properties:
        sender:
          type: string
          enum: [user, agent, system]
          example: "user"
        message:
          type: string
          example: "배송 언제되나요?"
        timestamp:
          type: string
          format: date-time
      required:
        - sender
        - message
        - timestamp

    TagsConfigRequest:
      type: object
      description: "태그 설정 요청 본문"
      properties:
        tags:
          type: array
          items:
            type: string
          minItems: 1
          example: ["긴급", "환불", "AS", "신규", "배송문의"]
      required:
        - tags

    # Notion
    NotionDatabaseRequest:
      type: object
      description: "노션 DB 생성 요청"
      properties:
        parentPageId:
          type: string
          description: "데이터베이스가 생성될 상위 페이지의 ID"
          example: "123e4567-e89b-12d3-a456-426614174000"
        title:
          type: string
          description: "새 데이터베이스의 제목"
          example: "고객 문의 아카이브"
      required:
        - parentPageId
        - title

    NotionDatabaseResponse:
      type: object
      description: "노션 DB 생성 응답"
      properties:
        databaseId:
          type: string
          description: "생성된 데이터베이스의 ID"
          example: "789e4567-e89b-12d3-a456-426614174aaa"
        databaseUrl:
          type: string
          format: uri
          description: "생성된 데이터베이스의 URL"
          example: "https://www.notion.so/..."
      required:
        - databaseId
        - databaseUrl

    NotionPageRequest:
      type: object
      description: "노션 페이지(행) 생성 요청"
      properties:
        properties:
          type: object
          description: "노션 DB의 속성(컬럼)에 맞게 매핑된 데이터"
          example: {
            "문의일시": { "date": { "start": "2025-11-06T13:00:00Z" } },
            "고객명": { "title": [ { "text": { "content": "홍길동" } } ] },
            "태그": { "multi_select": [ { "name": "환불" }, { "name": "긴급" } ] }
          }
        content:
          type: array
          minItems: 2
          description: "페이지 본문에 추가될 블록(채팅 내용)"
          items:
            type: object
          example: [
            {
              "object": "block",
              "type": "heading_2",
              "heading_2": { "rich_text": [ { "text": { "content": "채팅 내용" } } ] }
            },
            {
              "object": "block",
              "type": "paragraph",
              "paragraph": { "rich_text": [ { "text": { "content": "고객: 안녕하세요..." } } ] }
            }
          ]
      required:
        - properties

    NotionPageResponse:
      type: object
      description: "노션 페이지(행) 생성 응답"
      properties:
        pageId:
          type: string
          description: "생성된 페이지의 ID"
          example: "abc-123..."
        pageUrl:
          type: string
          format: uri
          description: "생성된 페이지의 URL"
          example: "https://www.notion.so/..."
      required:
        - pageId
        - pageUrl